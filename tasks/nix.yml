# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

tasks:
  build:lv426:
    desc: Build lv426 (macOS) system configuration
    cmds:
      - hack/nix-build.sh lv426

  build:work:
    desc: Build work system configuration (builds in work repo with reduced resources)
    cmds:
      - hack/nix-build.sh work --dry-run

  build:all:
    desc: Build all system configurations (lv426 and work)
    cmds:
      - task: build:lv426
      - task: build:work

  refresh:lv426:
    desc: Apply lv426 (macOS) system configuration
    cmds:
      - hack/nix-refresh.sh lv426

  refresh:work:
    desc: Apply work system configuration (builds and applies in work repo)
    cmds:
      - hack/nix-refresh.sh work

  clean:
    desc: Clean Nix store and delete old generations
    cmds:
      - hack/nix-clean.sh

  update:
    desc: Update Nix flake inputs and commit lock file
    cmds:
      - hack/nix-update.sh

  config:
    desc: Copy nix configs (custom and secrets) to /etc/nix/ with sudo
    cmds:
      - hack/nix-config.sh

  config:user:
    desc: Setup user-level nix.conf to include system nix.custom.conf
    cmds:
      - hack/nix-config-user.sh

  secrets:init:
    desc: Initialize nix.secrets.conf with GitHub token (automatic, idempotent)
    cmds:
      - hack/nix-secrets-init.sh

  validate:
    desc: Validate Nix configuration (format checks via flake check)
    cmds:
      - hack/nix-validate.sh
