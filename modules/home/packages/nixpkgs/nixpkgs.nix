{
  pkgs,
  values,
  ...
}:
let
  additionalPackages = values.nix.additionalPackages;

  baseNixPackages = with pkgs; [
    _1password-cli
    actionlint
    alt-tab-macos
    ansible
    ansible-lint
    argc
    argocd
    asciinema
    asciinema-agg
    atuin
    awk-language-server
    awscli2
    bash-language-server
    caddy
    cargo-watch
    chafa
    checkmake
    codespell
    colima
    copilot-cli
    copilot-language-server
    crossplane-cli
    deadnix
    delta
    delve
    direnv
    docker
    docker-compose
    docker-compose-language-service
    docker-language-server
    dotnet-runtime
    duf
    eslint
    fish
    fswatch
    gettext
    gh
    git-filter-repo
    glow
    gnupg
    go
    go-task
    golangci-lint
    gopls
    gum
    helm-ls
    jetbrains-mono
    jq
    jq-lsp
    jqp
    jrnl
    jsonld-cli
    k9s
    krew
    kube-linter
    kubecolor
    kubectl
    kubernetes-helm
    kustomize
    lazygit
    libgit2
    lua-language-server
    luajit
    macchina
    marksman
    mermaid-cli
    mods
    nil
    nix-prefetch
    nix-prefetch-docker
    nix-prefetch-git
    nix-prefetch-github
    nix-search-cli
    nix-your-shell
    nixd
    nixfmt-rfc-style
    nodePackages.fkill-cli
    nodePackages.jsonlint
    nodejs_22
    oh-my-posh
    ollama
    openscad
    openscad-lsp
    openssh
    pipx
    pkg-config
    proselint
    pyright
    python311
    rustc
    rustup
    sad
    sbarlua
    shellcheck
    shfmt
    simple-completion-language-server
    socat
    sshpass
    statix
    stern
    stylua
    swift
    taplo
    terraform-ls
    terraform-lsp
    textlint
    tflint
    tflint-plugins.tflint-ruleset-aws
    tfsec
    tig
    tlrc
    tmux
    typescript
    typescript-language-server
    upbound
    uv
    vale-ls
    vivid
    vscode-langservers-extracted
    watch
    yaml-language-server
    yamllint
    yarn
    yazi
    yq
    zig
    zls
    zoxide
  ];

  conditionalPackages =
    (if values.darwin.colima.enable or false then [ pkgs.colima ] else [ ])
    ++ (
      if values.darwin.podman.enable or false then
        [
          pkgs.podman-desktop
        ]
      else
        [ ]
    );

  allNixPackages = baseNixPackages ++ conditionalPackages ++ additionalPackages;
in
{
  home.packages = allNixPackages;
}
